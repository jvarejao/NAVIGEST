<?xml version="1.0" encoding="utf-8"?>
<ContentView x:Class="NAVIGEST.macOS.Views.NovaHoraView"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:NAVIGEST.macOS.Models"
             xmlns:res="clr-namespace:NAVIGEST.Shared.Resources.Strings;assembly=NAVIGEST.Shared"
             xmlns:behaviors="clr-namespace:NAVIGEST.macOS.Behaviors"
             BackgroundColor="Transparent">
  
    <Border BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#1C1C1E}"
            StrokeThickness="0"
            Padding="24"
            StrokeShape="RoundRectangle 18"
            WidthRequest="500"
            HeightRequest="850"
            VerticalOptions="Center"
            HorizontalOptions="Center">
        <Border.Shadow>
            <Shadow Brush="Black" Opacity="0.25" Radius="12" Offset="0,4"/>
        </Border.Shadow>
    
        <Grid RowDefinitions="Auto,*,Auto" RowSpacing="20">
            <!-- Header -->
            <Grid Grid.Row="0" ColumnDefinitions="Auto,*,Auto">
                <Label Text="✏️" FontSize="20" VerticalOptions="Center" Margin="0,0,8,0"/>
                <Label Grid.Column="1" 
                       Text="{x:Static res:AppResources.Hours_EditTitle}"
                       x:Name="TituloLabel"
                       FontSize="18"
                       FontAttributes="Bold"
                       VerticalOptions="Center"
                       TextColor="{AppThemeBinding Light=#000000, Dark=#FFFFFF}"/>
          
                <Button x:Name="EliminarButton"
                        Grid.Column="2"
                        Text="{x:Static res:AppResources.Common_Delete}"
                        BackgroundColor="#FF3B30"
                        TextColor="White"
                        FontSize="14"
                        FontAttributes="Bold"
                        CornerRadius="8"
                        HeightRequest="36"
                        Padding="12,0"
                        Clicked="OnEliminarClicked"
                        IsVisible="False"/>
            </Grid>

            <!-- Form -->
            <ScrollView Grid.Row="1">
                <VerticalStackLayout Spacing="16">
                    
                    <!-- Tipo de Registo -->
                    <VerticalStackLayout>
                        <Label Text="{x:Static res:AppResources.Hours_RecordType}" Style="{StaticResource MacHeaderLabelStyle}"/>
                        <Border Style="{StaticResource MacInputBorderStyle}">
                            <Grid ColumnDefinitions="*,Auto">
                                <Grid.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnSelecionarTipoRegistoTapped"/>
                                </Grid.GestureRecognizers>
                                <Label x:Name="TipoRegistoLabel"
                                       Text="{x:Static res:AppResources.Hours_Work}"
                                       Style="{StaticResource MacInputLabelStyle}"/>
                                <Label Grid.Column="1" Text="▼" FontSize="12" VerticalOptions="Center" TextColor="{AppThemeBinding Light=#8E8E93, Dark=#8E8E93}"/>
                            </Grid>
                        </Border>
                    </VerticalStackLayout>

                    <!-- Motivo Ausência -->
                    <VerticalStackLayout x:Name="AbsenceReasonContainer" IsVisible="False">
                        <Label Text="{x:Static res:AppResources.Hours_Reason}" Style="{StaticResource MacHeaderLabelStyle}"/>
                        <Border Style="{StaticResource MacInputBorderStyle}">
                            <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="8">
                                <Grid.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnSelecionarMotivoAusenciaTapped"/>
                                </Grid.GestureRecognizers>
                                <Label x:Name="AbsenceIconLabel"
                                       Text=""
                                       FontFamily="FA7Solid"
                                       Style="{StaticResource MacInputLabelStyle}"/>
                                <Label Grid.Column="1"
                                       x:Name="AbsenceReasonLabel"
                                       Text="{x:Static res:AppResources.Hours_SelectReason}"
                                       Style="{StaticResource MacInputLabelStyle}"/>
                                <Label Grid.Column="2" Text="▼" FontSize="12" VerticalOptions="Center" TextColor="{AppThemeBinding Light=#8E8E93, Dark=#8E8E93}"/>
                            </Grid>
                        </Border>
                    </VerticalStackLayout>

                    <!-- Colaborador -->
                    <VerticalStackLayout>
                        <Label Text="{x:Static res:AppResources.Hours_SelectCollaborator}" Style="{StaticResource MacHeaderLabelStyle}"/>
                        <Border Style="{StaticResource MacInputBorderStyle}">
                            <Grid ColumnDefinitions="*,Auto">
                                <Grid.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnSelecionarColaboradorClicked"/>
                                </Grid.GestureRecognizers>
                                <Label x:Name="ColaboradorLabel"
                                       Text="{x:Static res:AppResources.Hours_SelectCollaborator}"
                                       Style="{StaticResource MacInputLabelStyle}"/>
                                <Label Grid.Column="1" Text="▼" FontSize="12" VerticalOptions="Center" TextColor="{AppThemeBinding Light=#8E8E93, Dark=#8E8E93}"/>
                            </Grid>
                        </Border>
                    </VerticalStackLayout>

                    <!-- Data -->
                    <VerticalStackLayout>
                        <Label Text="{x:Static res:AppResources.Hours_Date}" Style="{StaticResource MacHeaderLabelStyle}"/>
                        <Border Style="{StaticResource MacInputBorderStyle}">
                            <Border.Triggers>
                                <DataTrigger TargetType="Border" Binding="{Binding Source={x:Reference DataPicker}, Path=IsFocused}" Value="True">
                                    <Setter Property="Stroke" Value="{StaticResource MacFocusBlue}"/>
                                    <Setter Property="StrokeThickness" Value="2"/>
                                </DataTrigger>
                            </Border.Triggers>
                            <DatePicker x:Name="DataPicker"
                                        Format="dd/MM/yyyy"
                                        TextColor="{AppThemeBinding Light=#000000, Dark=#FFFFFF}"
                                        BackgroundColor="Transparent"
                                        VerticalOptions="Center">
                                <DatePicker.Behaviors>
                                    <behaviors:MacInputBehavior />
                                </DatePicker.Behaviors>
                            </DatePicker>
                        </Border>
                    </VerticalStackLayout>

                    <!-- Cliente -->
                    <VerticalStackLayout x:Name="ClienteContainer">
                        <Label Text="{x:Static res:AppResources.Hours_Client}" Style="{StaticResource MacHeaderLabelStyle}"/>
                        <Border Style="{StaticResource MacInputBorderStyle}">
                            <Grid ColumnDefinitions="*,Auto">
                                <Grid.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnSelecionarClienteClicked"/>
                                </Grid.GestureRecognizers>
                                <Label x:Name="ClienteLabel"
                                       Text="{x:Static res:AppResources.Hours_NoClient}"
                                       Style="{StaticResource MacInputLabelStyle}"
                                       LineBreakMode="TailTruncation"/>
                                <Label Grid.Column="1" Text="▼" FontSize="12" VerticalOptions="Center" TextColor="{AppThemeBinding Light=#8E8E93, Dark=#8E8E93}"/>
                            </Grid>
                        </Border>
                    </VerticalStackLayout>

                    <!-- Horas Normais -->
                    <VerticalStackLayout x:Name="HorasNormaisContainer">
                        <Label Text="{x:Static res:AppResources.Hours_NormalHours}" Style="{StaticResource MacHeaderLabelStyle}"/>
                        <Border Style="{StaticResource MacInputBorderStyle}">
                            <Border.Triggers>
                                <DataTrigger TargetType="Border" Binding="{Binding Source={x:Reference HorasEntry}, Path=IsFocused}" Value="True">
                                    <Setter Property="Stroke" Value="{StaticResource MacFocusBlue}"/>
                                    <Setter Property="StrokeThickness" Value="2"/>
                                </DataTrigger>
                            </Border.Triggers>
                            <Entry x:Name="HorasEntry"
                                   Keyboard="Numeric"
                                   Placeholder="0.00"
                                   Style="{StaticResource MacEntryStyle}">
                                <Entry.Behaviors>
                                    <behaviors:MacInputBehavior />
                                </Entry.Behaviors>
                            </Entry>
                        </Border>
                    </VerticalStackLayout>

                    <!-- Horas Extras -->
                    <VerticalStackLayout x:Name="HorasExtrasContainer">
                        <Label Text="{x:Static res:AppResources.Hours_ExtraHours}" Style="{StaticResource MacHeaderLabelStyle}"/>
                        <Border Style="{StaticResource MacInputBorderStyle}">
                            <Border.Triggers>
                                <DataTrigger TargetType="Border" Binding="{Binding Source={x:Reference HorasExtrasEntry}, Path=IsFocused}" Value="True">
                                    <Setter Property="Stroke" Value="{StaticResource MacFocusBlue}"/>
                                    <Setter Property="StrokeThickness" Value="2"/>
                                </DataTrigger>
                            </Border.Triggers>
                            <Entry x:Name="HorasExtrasEntry"
                                   Keyboard="Numeric"
                                   Placeholder="0.00"
                                   Style="{StaticResource MacEntryStyle}">
                                <Entry.Behaviors>
                                    <behaviors:MacInputBehavior />
                                </Entry.Behaviors>
                            </Entry>
                        </Border>
                    </VerticalStackLayout>

                    <!-- Observações -->
                    <VerticalStackLayout>
                        <Label Text="{x:Static res:AppResources.Hours_Observations}" Style="{StaticResource MacHeaderLabelStyle}"/>
                        <Border Style="{StaticResource MacInputBorderStyle}" HeightRequest="100" Padding="12,8">
                            <Border.Triggers>
                                <DataTrigger TargetType="Border" Binding="{Binding Source={x:Reference ObservacoesEditor}, Path=IsFocused}" Value="True">
                                    <Setter Property="Stroke" Value="{StaticResource MacFocusBlue}"/>
                                    <Setter Property="StrokeThickness" Value="2"/>
                                </DataTrigger>
                            </Border.Triggers>
                            <Editor x:Name="ObservacoesEditor"
                                    Placeholder="Escreva aqui..."
                                    Style="{StaticResource MacEditorStyle}">
                                <Editor.Behaviors>
                                    <behaviors:MacInputBehavior />
                                </Editor.Behaviors>
                            </Editor>
                        </Border>
                    </VerticalStackLayout>

                </VerticalStackLayout>
            </ScrollView>

            <!-- Botões Ação -->
            <Grid Grid.Row="2" ColumnDefinitions="*,*" ColumnSpacing="12">
                <Button Grid.Column="0"
                        Text="{x:Static res:AppResources.Common_Cancel}"
                        BackgroundColor="{AppThemeBinding Light=#E5E5EA, Dark=#3A3A3C}"
                        TextColor="{AppThemeBinding Light=#000000, Dark=#FFFFFF}"
                        CornerRadius="8"
                        HeightRequest="50"
                        FontAttributes="Bold"
                        Clicked="OnCancelarClicked"/>
          
                <Button Grid.Column="1"
                        Text="{x:Static res:AppResources.Common_Update}"
                        BackgroundColor="#0A84FF"
                        TextColor="White"
                        CornerRadius="8"
                        HeightRequest="50"
                        FontAttributes="Bold"
                        Clicked="OnGuardarClicked"/>
            </Grid>
        </Grid>
    </Border>
</ContentView>