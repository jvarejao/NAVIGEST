<?xml version="1.0" encoding="utf-8"?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:NAVIGEST.macOS.PageModels"
             x:Class="NAVIGEST.macOS.Pages.DashboardPage"
             x:DataType="{x:Null}"
             BackgroundColor="#090F1D">
    <ContentPage.Resources>
        <Color x:Key="CardBg">#10172B</Color>
        <Color x:Key="CardBgMuted">#0D1424</Color>
        <Color x:Key="CardBorder">#1E293B</Color>
        <Color x:Key="AccentBlue">#3B82F6</Color>
        <Color x:Key="AccentCyan">#22D3EE</Color>
        <Color x:Key="AccentOrange">#F97316</Color>
        <Color x:Key="AccentRed">#EF4444</Color>
        <Color x:Key="AccentGreen">#10B981</Color>
        <Color x:Key="AccentYellow">#F59E0B</Color>
        <Color x:Key="TextMain">#E7ECF5</Color>
        <Color x:Key="TextSub">#9BA7C1</Color>

        <Style TargetType="Border" x:Key="Card">
            <Setter Property="StrokeShape">
                <Setter.Value>
                    <RoundRectangle CornerRadius="14" />
                </Setter.Value>
            </Setter>
            <Setter Property="Stroke" Value="{StaticResource CardBorder}" />
            <Setter Property="StrokeThickness" Value="1" />
            <Setter Property="Padding" Value="16" />
            <Setter Property="BackgroundColor" Value="{StaticResource CardBg}" />
        </Style>
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Padding="24,18,24,32" Spacing="18">
            <!-- Header with selectors -->
            <VerticalStackLayout Spacing="12">
                <VerticalStackLayout Spacing="4">
                    <Label Text="Dashboard" FontSize="24" FontAttributes="Bold" TextColor="{StaticResource TextMain}" />
                    <Label Text="Analítica financeira e vendas" FontSize="14" TextColor="{StaticResource TextSub}" />
                    <Label Text="{Binding HeaderSubtitle}" FontSize="12" TextColor="{StaticResource TextSub}" />
                </VerticalStackLayout>

                <HorizontalStackLayout Spacing="12" VerticalOptions="Center">
                    <Border Padding="12,8" BackgroundColor="{StaticResource CardBg}" Stroke="{StaticResource CardBorder}" StrokeThickness="1">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="12" />
                        </Border.StrokeShape>
                        <HorizontalStackLayout Spacing="10" VerticalOptions="Center">
                            <Button Text="◀" Command="{Binding DecreaseYearCommand}" WidthRequest="36" HeightRequest="32" BackgroundColor="Transparent" TextColor="{StaticResource TextMain}" FontAttributes="Bold" />
                            <Label Text="{Binding SelectedYear}" FontSize="18" FontAttributes="Bold" TextColor="{StaticResource TextMain}" />
                            <Button Text="▶" Command="{Binding IncreaseYearCommand}" WidthRequest="36" HeightRequest="32" BackgroundColor="Transparent" TextColor="{StaticResource TextMain}" FontAttributes="Bold" />
                        </HorizontalStackLayout>
                    </Border>

                    <Border BackgroundColor="{StaticResource CardBg}" Stroke="{StaticResource CardBorder}" StrokeThickness="1" Padding="10,6">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="12" />
                        </Border.StrokeShape>
                        <HorizontalStackLayout Spacing="8" VerticalOptions="Center">
                            <Label Text="{Binding CompareYearLabel}" TextColor="{StaticResource TextSub}" FontSize="12" />
                            <Switch IsToggled="{Binding ComparePreviousYear}" ThumbColor="{StaticResource AccentBlue}" OnColor="{StaticResource AccentBlue}" />
                        </HorizontalStackLayout>
                    </Border>
                </HorizontalStackLayout>

                <CollectionView x:Name="MonthList" ItemsSource="{Binding MonthOptions}" SelectionMode="Single" SelectedItem="{Binding SelectedMonthOption}" ItemsLayout="HorizontalList" HeightRequest="58" HorizontalScrollBarVisibility="Never">
                    <CollectionView.ItemsLayout>
                        <LinearItemsLayout ItemSpacing="10" Orientation="Horizontal" />
                    </CollectionView.ItemsLayout>
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Border Padding="12,10" BackgroundColor="{StaticResource CardBgMuted}" StrokeThickness="0" VerticalOptions="Center">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="10" />
                                </Border.StrokeShape>
                                <Label x:Name="MonthLabel" Text="{Binding Label}" FontSize="13" FontAttributes="Bold" TextColor="{StaticResource TextMain}" HorizontalTextAlignment="Center" />
                                <VisualStateManager.VisualStateGroups>
                                    <VisualStateGroupList>
                                        <VisualStateGroup x:Name="CommonStates">
                                            <VisualState x:Name="Normal" />
                                            <VisualState x:Name="Selected">
                                                <VisualState.Setters>
                                                    <Setter Property="BackgroundColor" Value="{StaticResource AccentBlue}" />
                                                </VisualState.Setters>
                                            </VisualState>
                                        </VisualStateGroup>
                                    </VisualStateGroupList>
                                </VisualStateManager.VisualStateGroups>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>

            <!-- Summary cards -->
            <CollectionView ItemsSource="{Binding SummaryCards}" ItemsLayout="HorizontalList" SelectionMode="None" HeightRequest="150">
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout ItemSpacing="14" Orientation="Horizontal" />
                </CollectionView.ItemsLayout>
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border Style="{StaticResource Card}" WidthRequest="240" BackgroundColor="{StaticResource CardBg}">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="16" />
                            </Border.StrokeShape>
                            <VerticalStackLayout Spacing="10">
                                <HorizontalStackLayout Spacing="8" VerticalOptions="Center">
                                    <BoxView WidthRequest="8" HeightRequest="36" CornerRadius="6" Color="{StaticResource AccentBlue}" />
                                    <VerticalStackLayout Spacing="2">
                                        <Label Text="{Binding Title}" FontSize="14" TextColor="{StaticResource TextSub}" />
                                        <Label Text="{Binding Value}" FontSize="26" FontAttributes="Bold" TextColor="{StaticResource TextMain}" />
                                    </VerticalStackLayout>
                                </HorizontalStackLayout>
                                <Label x:Name="DetailLabel" Text="{Binding Detail}" FontSize="12" TextColor="{StaticResource TextSub}">
                                    <Label.Triggers>
                                        <DataTrigger TargetType="Label" Binding="{Binding IsPositive}" Value="True">
                                            <Setter Property="TextColor" Value="{StaticResource AccentGreen}" />
                                        </DataTrigger>
                                        <DataTrigger TargetType="Label" Binding="{Binding IsPositive}" Value="False">
                                            <Setter Property="TextColor" Value="{StaticResource AccentRed}" />
                                        </DataTrigger>
                                    </Label.Triggers>
                                </Label>
                            </VerticalStackLayout>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- Charts -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="16">
                <Border Style="{StaticResource Card}">
                    <VerticalStackLayout Spacing="12">
                        <Grid ColumnDefinitions="*,Auto" VerticalOptions="Center">
                            <VerticalStackLayout Spacing="2">
                                <Label Text="Receitas vs Despesas" FontSize="16" FontAttributes="Bold" TextColor="{StaticResource TextMain}" />
                                <Label Text="Por mês" FontSize="12" TextColor="{StaticResource TextSub}" />
                            </VerticalStackLayout>
                            <HorizontalStackLayout Grid.Column="1" Spacing="12" VerticalOptions="Center">
                                <HorizontalStackLayout Spacing="6" VerticalOptions="Center">
                                    <Ellipse WidthRequest="10" HeightRequest="10" Fill="{StaticResource AccentBlue}" />
                                    <Label Text="Receitas" FontSize="11" TextColor="{StaticResource TextSub}" />
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Spacing="6" VerticalOptions="Center">
                                    <Ellipse WidthRequest="10" HeightRequest="10" Fill="{StaticResource AccentRed}" />
                                    <Label Text="Despesas" FontSize="11" TextColor="{StaticResource TextSub}" />
                                </HorizontalStackLayout>
                            </HorizontalStackLayout>
                        </Grid>

                        <Grid HeightRequest="240">
                            <BoxView HeightRequest="1" Color="{StaticResource CardBorder}" VerticalOptions="End" />
                            <CollectionView ItemsSource="{Binding RevenueVsCost}" ItemsLayout="HorizontalList" SelectionMode="None" HeightRequest="220">
                                <CollectionView.ItemsLayout>
                                    <LinearItemsLayout ItemSpacing="12" Orientation="Horizontal" />
                                </CollectionView.ItemsLayout>
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid HeightRequest="220" WidthRequest="80" Padding="4,0">
                                            <Grid RowDefinitions="*,Auto,Auto" RowSpacing="6">
                                                <Grid Grid.Row="0" ColumnDefinitions="Auto,Auto,Auto" ColumnSpacing="6" VerticalOptions="End" HeightRequest="180">
                                                    <Border BackgroundColor="{StaticResource AccentBlue}" StrokeThickness="0" WidthRequest="20" HeightRequest="{Binding Height}" VerticalOptions="End" />
                                                    <Border Grid.Column="1" BackgroundColor="{StaticResource AccentRed}" StrokeThickness="0" WidthRequest="20" HeightRequest="{Binding SecondaryHeight}" VerticalOptions="End" />
                                                    <Border Grid.Column="2" BackgroundColor="{StaticResource AccentCyan}" StrokeThickness="0" WidthRequest="8" HeightRequest="{Binding PrevHeight}" VerticalOptions="End" />
                                                </Grid>
                                                <Label Grid.Row="1" Text="{Binding Display}" FontSize="11" HorizontalTextAlignment="Center" TextColor="{StaticResource TextSub}" />
                                                <Label Grid.Row="2" Text="{Binding Label}" FontSize="12" HorizontalTextAlignment="Center" TextColor="{StaticResource TextMain}" />
                                            </Grid>
                                        </Grid>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </Grid>
                    </VerticalStackLayout>
                </Border>

                <Border Grid.Column="1" Style="{StaticResource Card}">
                    <VerticalStackLayout Spacing="12">
                        <Grid ColumnDefinitions="*,Auto" VerticalOptions="Center">
                            <VerticalStackLayout Spacing="2">
                                <Label Text="Fluxo de Caixa" FontSize="16" FontAttributes="Bold" TextColor="{StaticResource TextMain}" />
                                <Label Text="Entradas - saídas mensais" FontSize="12" TextColor="{StaticResource TextSub}" />
                            </VerticalStackLayout>
                            <HorizontalStackLayout Grid.Column="1" Spacing="8" VerticalOptions="Center">
                                <Ellipse WidthRequest="10" HeightRequest="10" Fill="{StaticResource AccentGreen}" />
                                <Label Text="Positivo" FontSize="11" TextColor="{StaticResource TextSub}" />
                                <Ellipse WidthRequest="10" HeightRequest="10" Fill="{StaticResource AccentRed}" />
                                <Label Text="Negativo" FontSize="11" TextColor="{StaticResource TextSub}" />
                            </HorizontalStackLayout>
                        </Grid>

                        <Grid HeightRequest="240">
                            <BoxView HeightRequest="1" Color="{StaticResource CardBorder}" VerticalOptions="End" />
                            <CollectionView ItemsSource="{Binding CashFlow}" ItemsLayout="HorizontalList" SelectionMode="None" HeightRequest="220">
                                <CollectionView.ItemsLayout>
                                    <LinearItemsLayout ItemSpacing="12" Orientation="Horizontal" />
                                </CollectionView.ItemsLayout>
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid HeightRequest="220" WidthRequest="80" Padding="4,0">
                                            <Grid RowDefinitions="*,Auto,Auto" RowSpacing="6">
                                                <Border x:Name="CashBar" Grid.Row="0" BackgroundColor="{StaticResource AccentGreen}" StrokeThickness="0" WidthRequest="26" HeightRequest="{Binding Height}" VerticalOptions="End">
                                                    <Border.Triggers>
                                                        <DataTrigger TargetType="Border" Binding="{Binding IsNegative}" Value="True">
                                                            <Setter Property="BackgroundColor" Value="{StaticResource AccentRed}" />
                                                        </DataTrigger>
                                                    </Border.Triggers>
                                                </Border>
                                                <Label Grid.Row="1" Text="{Binding Display}" FontSize="11" HorizontalTextAlignment="Center" TextColor="{StaticResource TextSub}" />
                                                <Label Grid.Row="2" Text="{Binding Label}" FontSize="12" HorizontalTextAlignment="Center" TextColor="{StaticResource TextMain}" />
                                            </Grid>
                                        </Grid>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </Grid>
                    </VerticalStackLayout>
                </Border>
            </Grid>

            <!-- Tops -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="16">
                <Border Style="{StaticResource Card}">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="Top Clientes" FontSize="16" FontAttributes="Bold" TextColor="{StaticResource TextMain}" />
                        <CollectionView ItemsSource="{Binding TopClients}" SelectionMode="None">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Grid ColumnDefinitions="*,Auto" Padding="0,4">
                                        <Label Text="{Binding Name}" TextColor="{StaticResource TextMain}" />
                                        <HorizontalStackLayout Grid.Column="1" Spacing="8" VerticalOptions="Center">
                                            <Label Text="{Binding Value}" TextColor="{StaticResource TextMain}" FontAttributes="Bold" />
                                            <Border HeightRequest="8" WidthRequest="72" BackgroundColor="{StaticResource CardBgMuted}">
                                                <Border.StrokeShape>
                                                    <RoundRectangle CornerRadius="4" />
                                                </Border.StrokeShape>
                                                <BoxView HorizontalOptions="Start" Color="{StaticResource AccentBlue}" WidthRequest="{Binding Percent}" HeightRequest="8" CornerRadius="4" />
                                            </Border>
                                        </HorizontalStackLayout>
                                    </Grid>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </Border>

                <Border Grid.Column="1" Style="{StaticResource Card}">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="Produtos mais vendidos" FontSize="16" FontAttributes="Bold" TextColor="{StaticResource TextMain}" />
                        <CollectionView ItemsSource="{Binding TopProducts}" SelectionMode="None">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Grid ColumnDefinitions="*,Auto" Padding="0,4">
                                        <Label Text="{Binding Name}" TextColor="{StaticResource TextMain}" />
                                        <HorizontalStackLayout Grid.Column="1" Spacing="8" VerticalOptions="Center">
                                            <Label Text="{Binding Value}" TextColor="{StaticResource TextMain}" FontAttributes="Bold" />
                                            <Border HeightRequest="8" WidthRequest="72" BackgroundColor="{StaticResource CardBgMuted}">
                                                <Border.StrokeShape>
                                                    <RoundRectangle CornerRadius="4" />
                                                </Border.StrokeShape>
                                                <BoxView HorizontalOptions="Start" Color="{StaticResource AccentGreen}" WidthRequest="{Binding Percent}" HeightRequest="8" CornerRadius="4" />
                                            </Border>
                                        </HorizontalStackLayout>
                                    </Grid>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </Border>
            </Grid>

            <Border Style="{StaticResource Card}">
                <VerticalStackLayout Spacing="10">
                    <Label Text="Top Vendedores" FontSize="16" FontAttributes="Bold" TextColor="{StaticResource TextMain}" />
                    <CollectionView ItemsSource="{Binding TopSellers}" ItemsLayout="VerticalList" SelectionMode="None">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Grid ColumnDefinitions="*,Auto" Padding="0,4">
                                    <Label Text="{Binding Name}" TextColor="{StaticResource TextMain}" />
                                    <HorizontalStackLayout Grid.Column="1" Spacing="8" VerticalOptions="Center">
                                        <Label Text="{Binding Value}" TextColor="{StaticResource TextMain}" FontAttributes="Bold" />
                                        <Border HeightRequest="8" WidthRequest="72" BackgroundColor="{StaticResource CardBgMuted}">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="4" />
                                            </Border.StrokeShape>
                                            <BoxView HorizontalOptions="Start" Color="{StaticResource AccentOrange}" WidthRequest="{Binding Percent}" HeightRequest="8" CornerRadius="4" />
                                        </Border>
                                    </HorizontalStackLayout>
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Border>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
