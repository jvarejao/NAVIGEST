<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="NAVIGEST.macOS.Pages.DbConfigPage"
             x:DataType="{x:Null}"
             Title="Configuração da Ligação"
             Shell.FlyoutBehavior="Disabled"
             Shell.NavBarIsVisible="False">

    <!-- Fundo adaptável ao tema -->
    <Grid Padding="24" BackgroundColor="{AppThemeBinding Light=#F2F2F7, Dark=#000000}">
        <ScrollView>
            <HorizontalStackLayout HorizontalOptions="Center" VerticalOptions="Center">
                <Grid MaximumWidthRequest="600">
                    <!-- Cartão Adaptável (Estilo Popup) -->
                    <Border x:Name="Card" Padding="32" StrokeThickness="0" 
                            StrokeShape="RoundRectangle 18"
                            BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#1C1C1E}">
                        <Border.Shadow>
                            <Shadow Brush="Black" Opacity="0.25" Radius="12" Offset="0,4"/>
                        </Border.Shadow>
                    <VerticalStackLayout Spacing="14">

                        <!-- Cabeçalho simples -->
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="10">
                             <Button Text="&#xF060;" FontFamily="FA7Solid" 
                                    BackgroundColor="Transparent" TextColor="{AppThemeBinding Light=Black, Dark=White}" 
                                    FontSize="20" Clicked="OnBackClicked" 
                                    WidthRequest="40" HeightRequest="40" 
                                    HorizontalOptions="Start" />
                            <HorizontalStackLayout Grid.Column="1" Spacing="8" HorizontalOptions="Center">
                                <Label Text="&#xF233;" FontFamily="FA7Solid" FontSize="28"
                         TextColor="{StaticResource Color.Primary}" />
                                <Label Text="Configuração da Base de Dados"
                         FontSize="20" FontAttributes="Bold" TextColor="{AppThemeBinding Light=Black, Dark=White}" />
                            </HorizontalStackLayout>
                        </Grid>

                        <!-- Servidor -->
                        <VerticalStackLayout>
                            <Label Text="Servidor" FontAttributes="Bold" TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
                            <Border x:Name="ServerBorder" 
                                    BackgroundColor="{AppThemeBinding Light=#F2F2F7, Dark=#2C2C2E}"
                                    StrokeThickness="0"
                                    StrokeShape="RoundRectangle 8">
                                <Entry x:Name="ServerEntry"
                                       Placeholder="ex.: 100.81.152.95"
                                       Text="{Binding Server}"
                                       BackgroundColor="Transparent"
                                       TextColor="{AppThemeBinding Light=Black, Dark=White}"
                                       PlaceholderColor="{AppThemeBinding Light=#999999, Dark=#8E8E93}"
                                       HeightRequest="44"
                                       FontSize="16"
                                       VerticalTextAlignment="Center"
                                       Completed="OnEntryCompleted"
                                       Focused="OnEntryFocused"
                                       Unfocused="OnEntryUnfocused"
                                       TextChanged="OnEntryTextChanged" />
                            </Border>
                            <Label x:Name="ServerError" Text="Servidor obrigatório." TextColor="#FFA500" IsVisible="False" FontSize="12"/>
                        </VerticalStackLayout>

                        <!-- Porta -->
                        <VerticalStackLayout>
                            <Label Text="Porta" FontAttributes="Bold" TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
                            <Border x:Name="PortBorder" 
                                    BackgroundColor="{AppThemeBinding Light=#F2F2F7, Dark=#2C2C2E}"
                                    StrokeThickness="0"
                                    StrokeShape="RoundRectangle 8">
                                <Entry x:Name="PortEntry"
                                       Placeholder="3307"
                                       Keyboard="Numeric"
                                       Text="{Binding Port}"
                                       BackgroundColor="Transparent"
                                       TextColor="{AppThemeBinding Light=Black, Dark=White}"
                                       PlaceholderColor="{AppThemeBinding Light=#999999, Dark=#8E8E93}"
                                       HeightRequest="44"
                                       FontSize="16"
                                       VerticalTextAlignment="Center"
                                       Completed="OnEntryCompleted"
                                       Focused="OnEntryFocused"
                                       Unfocused="OnEntryUnfocused"
                                       TextChanged="OnEntryTextChanged" />
                            </Border>
                            <Label x:Name="PortError" Text="Porta inválida (1–65535)." TextColor="#FFA500" IsVisible="False" FontSize="12"/>
                        </VerticalStackLayout>

                        <!-- Base de Dados -->
                        <VerticalStackLayout>
                            <Label Text="Base de Dados" FontAttributes="Bold" TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
                            <Border x:Name="DbBorder" 
                                    BackgroundColor="{AppThemeBinding Light=#F2F2F7, Dark=#2C2C2E}"
                                    StrokeThickness="0"
                                    StrokeShape="RoundRectangle 8">
                                <Entry x:Name="DbEntry"
                                       Placeholder="YAHPUBLICIDADE2025"
                                       Text="{Binding Database}"
                                       BackgroundColor="Transparent"
                                       TextColor="{AppThemeBinding Light=Black, Dark=White}"
                                       PlaceholderColor="{AppThemeBinding Light=#999999, Dark=#8E8E93}"
                                       HeightRequest="44"
                                       FontSize="16"
                                       VerticalTextAlignment="Center"
                                       Completed="OnEntryCompleted"
                                       Focused="OnEntryFocused"
                                       Unfocused="OnEntryUnfocused"
                                       TextChanged="OnEntryTextChanged" />
                            </Border>
                            <Label x:Name="DbError" Text="Nome da base de dados obrigatório." TextColor="#FFA500" IsVisible="False" FontSize="12"/>
                        </VerticalStackLayout>

                        <!-- Utilizador -->
                        <VerticalStackLayout>
                            <Label Text="Utilizador" FontAttributes="Bold" TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
                            <Border x:Name="UserBorder" 
                                    BackgroundColor="{AppThemeBinding Light=#F2F2F7, Dark=#2C2C2E}"
                                    StrokeThickness="0"
                                    StrokeShape="RoundRectangle 8">
                                <Entry x:Name="UserEntry"
                                       Placeholder="YAH"
                                       Text="{Binding UserId}"
                                       BackgroundColor="Transparent"
                                       TextColor="{AppThemeBinding Light=Black, Dark=White}"
                                       PlaceholderColor="{AppThemeBinding Light=#999999, Dark=#8E8E93}"
                                       HeightRequest="44"
                                       FontSize="16"
                                       VerticalTextAlignment="Center"
                                       Completed="OnEntryCompleted"
                                       Focused="OnEntryFocused"
                                       Unfocused="OnEntryUnfocused"
                                       TextChanged="OnEntryTextChanged" />
                            </Border>
                            <Label x:Name="UserError" Text="Utilizador obrigatório." TextColor="#FFA500" IsVisible="False" FontSize="12"/>
                        </VerticalStackLayout>

                        <!-- Password -->
                        <VerticalStackLayout>
                            <Label Text="Password" FontAttributes="Bold" TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
                            <Border x:Name="PasswordBorder" 
                                    BackgroundColor="{AppThemeBinding Light=#F2F2F7, Dark=#2C2C2E}"
                                    StrokeThickness="0"
                                    StrokeShape="RoundRectangle 8">
                                <Entry x:Name="PasswordEntry"
                                       Placeholder="Password"
                                       IsPassword="True"
                                       Text="{Binding Password}"
                                       BackgroundColor="Transparent"
                                       TextColor="{AppThemeBinding Light=Black, Dark=White}"
                                       PlaceholderColor="{AppThemeBinding Light=#999999, Dark=#8E8E93}"
                                       HeightRequest="44"
                                       FontSize="16"
                                       VerticalTextAlignment="Center"
                                       Completed="OnEntryCompleted"
                                       Focused="OnEntryFocused"
                                       Unfocused="OnEntryUnfocused"
                                       TextChanged="OnEntryTextChanged" />
                            </Border>
                            <Label x:Name="PasswordError" Text="Password obrigatória." TextColor="#FFA500" IsVisible="False" FontSize="12"/>
                        </VerticalStackLayout>

                        <!-- Email (opcional) -->
                        <VerticalStackLayout>
                            <Label Text="Email de contacto (opcional)" FontAttributes="Bold" TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
                            <Border x:Name="EmailBorder" 
                                    BackgroundColor="{AppThemeBinding Light=#F2F2F7, Dark=#2C2C2E}"
                                    StrokeThickness="0"
                                    StrokeShape="RoundRectangle 8">
                                <Entry x:Name="EmailEntry"
                                       Placeholder="ex.: admin@yah.pt"
                                       BackgroundColor="Transparent"
                                       TextColor="{AppThemeBinding Light=Black, Dark=White}"
                                       PlaceholderColor="{AppThemeBinding Light=#999999, Dark=#8E8E93}"
                                       HeightRequest="44"
                                       FontSize="16"
                                       VerticalTextAlignment="Center"
                                       Completed="OnEntryCompleted"
                                       Focused="OnEntryFocused"
                                       Unfocused="OnEntryUnfocused"
                                       TextChanged="OnEntryTextChanged" />
                            </Border>
                            <Label x:Name="EmailErrorLabel" Text="Formato de email inválido." TextColor="#FF3B30" IsVisible="False" FontSize="12"/>
                        </VerticalStackLayout>

                        <!-- Botão principal -->
                        <Button x:Name="SaveTestButton"
                                Style="{StaticResource AppleFilledButton}"
                                Clicked="OnSaveAndTestClicked"
                                Text="Guardar e Testar"
                                Margin="0,12,0,0">
                            <Button.ImageSource>
                                <FontImageSource Glyph="&#xf0c7;" FontFamily="FA7Solid" Size="16" Color="White"/>
                            </Button.ImageSource>
                        </Button>

                        <VerticalStackLayout Padding="0,24,0,0" Spacing="18">                        
                            <Button x:Name="BtnTestarDb"
                                    Style="{StaticResource AppleTintedButton}"
                                    Text="Testar ligação à Base de Dados"
                                    Clicked="BtnTestarDb_Clicked"
                                    SemanticProperties.Description="Executa teste de ligação ao MariaDB" />
                            <Label x:Name="LblResultado"
                                   Text=""
                                   FontSize="13"
                                   HorizontalTextAlignment="Center"
                                   TextColor="{DynamicResource TextSecondaryColor}" />
                        </VerticalStackLayout>

                    </VerticalStackLayout>
                </Border>
                </Grid>
            </HorizontalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>
