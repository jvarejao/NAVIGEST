<?xml version="1.0" encoding="utf-8" ?>
<toolkit:Popup xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
               xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
               xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
               xmlns:models="clr-namespace:NAVIGEST.macOS.Models"
               xmlns:popups="clr-namespace:NAVIGEST.macOS.Popups"
               xmlns:behaviors="clr-namespace:NAVIGEST.macOS.Behaviors"
               x:Class="NAVIGEST.macOS.Popups.ProductPickerPopup"
               Color="Transparent"
               CanBeDismissedByTappingOutsideOfPopup="True">
    
    <toolkit:Popup.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../Resources/Styles/MacInputStyles.xaml" />
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </toolkit:Popup.Resources>

    <Border StrokeShape="RoundRectangle 18" 
            BackgroundColor="{DynamicResource PageBackgroundColor}"
            WidthRequest="600"
            HeightRequest="600"
            Padding="20">
        <Border.Shadow>
            <Shadow Brush="Black" Offset="0,5" Radius="15" Opacity="0.2"/>
        </Border.Shadow>
        
        <Grid RowDefinitions="Auto, Auto, *">
            <Label Text="Selecionar Produto" FontSize="18" FontAttributes="Bold" Margin="0,0,0,10"/>
            
            <Border Grid.Row="1"
                    Style="{StaticResource MacInputBorderStyle}"
                    Padding="8,0"
                    Margin="0,0,0,10">
                <Border.Triggers>
                    <DataTrigger TargetType="Border" Binding="{Binding Source={x:Reference SearchEntry}, Path=IsFocused}" Value="True">
                        <Setter Property="Stroke" Value="{StaticResource MacFocusBlue}"/>
                        <Setter Property="StrokeThickness" Value="2"/>
                    </DataTrigger>
                </Border.Triggers>
                <Entry x:Name="SearchEntry"
                       Placeholder="Pesquisar produto..." 
                       TextChanged="OnSearchTextChanged"
                       Style="{StaticResource MacEntryStyle}">
                    <Entry.Behaviors>
                        <behaviors:MacInputBehavior />
                    </Entry.Behaviors>
                </Entry>
            </Border>
            
            <CollectionView Grid.Row="2" 
                            x:Name="ProductsList" 
                            SelectionMode="Single"
                            SelectionChanged="OnSelectionChanged">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border StrokeThickness="0" Padding="10" Margin="0,2" BackgroundColor="{DynamicResource CardBackgroundColor}">
                            <Grid ColumnDefinitions="*, Auto">
                                <VerticalStackLayout>
                                    <Label Text="{Binding Product.PRODNOME}" FontAttributes="Bold" TextColor="{DynamicResource BodyTextColor}"/>
                                    <Label Text="{Binding Product.PRODCODIGO}" FontSize="12" TextColor="Gray"/>
                                </VerticalStackLayout>
                                <Label Grid.Column="1" Text="{Binding Product.PRECOVENDA, StringFormat='{0:C}'}" VerticalOptions="Center" TextColor="{DynamicResource BodyTextColor}"
                                       IsVisible="{Binding ShowPrice}"/>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
            
            <ActivityIndicator Grid.Row="2" x:Name="LoadingIndicator" IsRunning="False" HorizontalOptions="Center" VerticalOptions="Center"/>
        </Grid>
    </Border>
</toolkit:Popup>