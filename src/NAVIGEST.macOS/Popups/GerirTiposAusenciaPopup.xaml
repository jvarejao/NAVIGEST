<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:NAVIGEST.macOS.Models"
             x:Class="NAVIGEST.macOS.Popups.GerirTiposAusenciaPopup"
             BackgroundColor="{AppThemeBinding Light=#80000000, Dark=#80000000}">

    <Grid HorizontalOptions="Fill" VerticalOptions="Fill">
        <!-- Fundo clicÃ¡vel para fechar (opcional, mas simula popup) -->
        <Grid.GestureRecognizers>
            <TapGestureRecognizer Tapped="OnCloseClicked" />
        </Grid.GestureRecognizers>

        <Border StrokeShape="RoundRectangle 10"
                StrokeThickness="0"
                BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                WidthRequest="400"
                HeightRequest="650"
                Padding="20"
                HorizontalOptions="Center"
                VerticalOptions="Center">
            
            <!-- Bloqueia o clique de fechar o fundo -->
            <Border.GestureRecognizers>
                <TapGestureRecognizer />
            </Border.GestureRecognizers>
        
            <Grid RowDefinitions="Auto, *, Auto, Auto" RowSpacing="15">
                
                <!-- Header -->
                <Grid ColumnDefinitions="*, Auto">
                    <Label Text="Gerir Tipos de AusÃªncia"
                           FontSize="20"
                           FontAttributes="Bold"
                           VerticalOptions="Center"
                           TextColor="{AppThemeBinding Light=Black, Dark=White}" />
                    
                    <Button Grid.Column="1" 
                            Text="âœ•" 
                            Clicked="OnCloseClicked"
                            BackgroundColor="Transparent"
                            TextColor="{AppThemeBinding Light=Black, Dark=White}" />
                </Grid>

                <!-- List -->
                <CollectionView x:Name="cvTypes" 
                                Grid.Row="1"
                            SelectionMode="None">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:AbsenceType">
                        <Border StrokeShape="RoundRectangle 5"
                                StrokeThickness="1"
                                Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#333333}"
                                BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#2D2D2D}"
                                Padding="10"
                                Margin="0,0,0,8">
                            <Grid ColumnDefinitions="Auto, *, Auto, Auto" ColumnSpacing="10">
                                <Label Text="{Binding Icon}"
                                       FontFamily="FA7Solid"
                                       FontSize="18"
                                       VerticalOptions="Center"
                                       TextColor="{AppThemeBinding Light=Black, Dark=White}" />
                                
                                <Label Grid.Column="1"
                                       Text="{Binding Description}"
                                       VerticalOptions="Center"
                                       TextColor="{AppThemeBinding Light=Black, Dark=White}" />
                                
                                <!-- Edit Button -->
                                <Button Grid.Column="2"
                                        Text="âœŽ"
                                        TextColor="{AppThemeBinding Light=#007AFF, Dark=#0A84FF}"
                                        BackgroundColor="Transparent"
                                        BorderColor="Transparent"
                                        Clicked="OnEditClicked"
                                        CommandParameter="{Binding .}"
                                        WidthRequest="40"
                                        HeightRequest="40" />

                                <!-- Delete Button (Replacing SwipeView) -->
                                <Button Grid.Column="3"
                                        Text="ðŸ—‘"
                                        TextColor="{AppThemeBinding Light=#FF3B30, Dark=#FF453A}"
                                        BackgroundColor="Transparent"
                                        BorderColor="Transparent"
                                        Clicked="OnDeleteClicked"
                                        CommandParameter="{Binding .}"
                                        WidthRequest="40"
                                        HeightRequest="40" />
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
                <CollectionView.EmptyView>
                    <Label Text="Nenhum tipo de ausÃªncia definido."
                           HorizontalOptions="Center"
                           VerticalOptions="Center"
                           TextColor="Gray" />
                </CollectionView.EmptyView>
            </CollectionView>

            <!-- Add New -->
            <Grid Grid.Row="2" RowDefinitions="Auto, Auto" RowSpacing="10">
                <Label Text="Selecione um Ã­cone:" FontSize="12" TextColor="Gray" />
                
                <!-- Icon Selection -->
                <CollectionView x:Name="cvIcons"
                                Grid.Row="1"
                                HeightRequest="120"
                                SelectionMode="Single"
                                SelectionChanged="OnIconSelectionChanged">
                    <CollectionView.ItemsLayout>
                        <GridItemsLayout Orientation="Vertical" Span="6" VerticalItemSpacing="5" HorizontalItemSpacing="5" />
                    </CollectionView.ItemsLayout>
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Border StrokeShape="RoundRectangle 5"
                                    StrokeThickness="1"
                                    Padding="0"
                                    HeightRequest="40">
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnIconTapped" CommandParameter="{Binding .}" />
                                </Border.GestureRecognizers>
                                <VisualStateManager.VisualStateGroups>
                                    <VisualStateGroupList>
                                        <VisualStateGroup x:Name="CommonStates">
                                            <VisualState x:Name="Normal">
                                                <VisualState.Setters>
                                                    <Setter Property="BackgroundColor" Value="Transparent" />
                                                    <Setter Property="Stroke" Value="Transparent" />
                                                </VisualState.Setters>
                                            </VisualState>
                                            <VisualState x:Name="Selected">
                                                <VisualState.Setters>
                                                    <Setter Property="BackgroundColor" Value="{AppThemeBinding Light=#E0E0E0, Dark=#333333}" />
                                                    <Setter Property="Stroke" Value="{AppThemeBinding Light=#007AFF, Dark=#0A84FF}" />
                                                    <Setter Property="StrokeThickness" Value="2" />
                                                </VisualState.Setters>
                                            </VisualState>
                                        </VisualStateGroup>
                                    </VisualStateGroupList>
                                </VisualStateManager.VisualStateGroups>
                                <Label Text="{Binding .}"
                                       FontFamily="FA7Solid"
                                       FontSize="20"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center"
                                       TextColor="{AppThemeBinding Light=Black, Dark=White}" />
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </Grid>

            <!-- Input & Action -->
            <Grid Grid.Row="3" ColumnDefinitions="Auto, *, Auto" ColumnSpacing="10">
                <Border StrokeShape="RoundRectangle 5"
                        StrokeThickness="1"
                        Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#333333}"
                        BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#2D2D2D}"
                        WidthRequest="40"
                        HeightRequest="40"
                        VerticalOptions="Center">
                    <Label x:Name="lblSelectedIcon"
                           Text="?"
                           FontFamily="FA7Solid"
                           FontSize="20"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"
                           TextColor="{AppThemeBinding Light=Black, Dark=White}" />
                </Border>
                
                <Entry Grid.Column="1"
                       x:Name="txtNewType"
                       Placeholder="Nome do Tipo..."
                       TextColor="{AppThemeBinding Light=Black, Dark=White}"
                       PlaceholderColor="Gray" 
                       HeightRequest="44"
                       VerticalOptions="Center"/>
                       
                <Button Grid.Column="2"
                        x:Name="btnAddOrUpdate"
                        Text="Adicionar"
                        Clicked="OnAddClicked"
                        BackgroundColor="{AppThemeBinding Light=#007AFF, Dark=#0A84FF}"
                        TextColor="White"
                        HeightRequest="40"
                        CornerRadius="8"
                        VerticalOptions="Center"/>
            </Grid>
        </Grid>
    </Border>
    </Grid>
</ContentPage>