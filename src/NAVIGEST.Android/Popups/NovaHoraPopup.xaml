<?xml version="1.0" encoding="utf-8"?>
<toolkit:Popup x:Class="NAVIGEST.Android.Popups.NovaHoraPopup"
               xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
               xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
               xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
               xmlns:models="clr-namespace:NAVIGEST.Android.Models"
               CanBeDismissedByTappingOutsideOfPopup="False">
  <toolkit:Popup.Size>
    <Size Width="400" Height="680" />
  </toolkit:Popup.Size>

  <Border BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#1C1C1E}"
          StrokeThickness="0"
          Padding="24"
          StrokeShape="RoundRectangle 18">
    <Border.Shadow>
      <Shadow Brush="Black" Opacity="0.25" Radius="12" Offset="0,4"/>
    </Border.Shadow>
    
    <Grid RowDefinitions="Auto,*,Auto" RowSpacing="20">
      <!-- TÃ­tulo -->
      <Label Grid.Row="0"
             x:Name="TituloLabel"
             Text="âž• NOVO REGISTO DE HORAS"
             FontSize="20"
             FontAttributes="Bold"
             HorizontalOptions="Center"
             TextColor="{AppThemeBinding Light=#000000, Dark=#FFFFFF}"/>

      <!-- FormulÃ¡rio -->
      <ScrollView Grid.Row="1">
        <VerticalStackLayout Spacing="16">
          <!-- Colaborador -->
          <Grid RowDefinitions="Auto,Auto" RowSpacing="6">
            <Label Text="ðŸ‘¤ Colaborador"
                   FontSize="14"
                   FontAttributes="Bold"
                   TextColor="{AppThemeBinding Light=#000000, Dark=#FFFFFF}"/>
            <Border Grid.Row="1"
                    BackgroundColor="{AppThemeBinding Light=#F2F2F7, Dark=#2C2C2E}"
                    StrokeThickness="0"
                    StrokeShape="RoundRectangle 8">
              <Grid ColumnDefinitions="*,Auto">
                <Label x:Name="ColaboradorLabel"
                       Text="Selecione colaborador"
                       Padding="12,10"
                       VerticalOptions="Center"
                       TextColor="{AppThemeBinding Light=#000000, Dark=#FFFFFF}"/>
                <Button Grid.Column="1"
                        Text="ðŸ”"
                        FontSize="20"
                        BackgroundColor="Transparent"
                        TextColor="{AppThemeBinding Light=#007AFF, Dark=#0A84FF}"
                        Clicked="OnSelecionarColaboradorClicked"
                        WidthRequest="50"/>
              </Grid>
            </Border>
            <Picker x:Name="ColaboradorPicker"
                    Grid.Row="1"
                    IsVisible="False"
                    BackgroundColor="{AppThemeBinding Light=#F2F2F7, Dark=#2C2C2E}"
                    TextColor="{AppThemeBinding Light=#000000, Dark=#FFFFFF}"/>
          </Grid>

          <!-- Cliente -->
          <Grid RowDefinitions="Auto,Auto" RowSpacing="6">
            <Label Text="ðŸ¢ Cliente"
                   FontSize="14"
                   FontAttributes="Bold"
                   TextColor="{AppThemeBinding Light=#000000, Dark=#FFFFFF}"/>
            <Border Grid.Row="1"
                    BackgroundColor="{AppThemeBinding Light=#F2F2F7, Dark=#2C2C2E}"
                    StrokeThickness="0"
                    StrokeShape="RoundRectangle 8">
              <Grid ColumnDefinitions="*,Auto">
                <Label x:Name="ClienteLabel"
                       Text="Sem cliente"
                       Padding="12,10"
                       VerticalOptions="Center"
                       TextColor="{AppThemeBinding Light=#000000, Dark=#FFFFFF}"/>
                <Button Grid.Column="1"
                        Text="ðŸ”"
                        FontSize="20"
                        BackgroundColor="Transparent"
                        TextColor="{AppThemeBinding Light=#007AFF, Dark=#0A84FF}"
                        Clicked="OnPesquisarClienteClicked"
                        WidthRequest="50"/>
              </Grid>
            </Border>
            <Picker x:Name="ClientePicker"
                    Grid.Row="1"
                    IsVisible="False"
                    BackgroundColor="{AppThemeBinding Light=#F2F2F7, Dark=#2C2C2E}"
                    TextColor="{AppThemeBinding Light=#000000, Dark=#FFFFFF}"/>
          </Grid>

          <!-- Data -->
          <Grid RowDefinitions="Auto,Auto" RowSpacing="6">
            <Label Text="ðŸ“… Data"
                   FontSize="14"
                   FontAttributes="Bold"
                   TextColor="{AppThemeBinding Light=#000000, Dark=#FFFFFF}"/>
            <DatePicker x:Name="DataPicker"
                        Grid.Row="1"
                        BackgroundColor="{AppThemeBinding Light=#F2F2F7, Dark=#2C2C2E}"
                        TextColor="{AppThemeBinding Light=#000000, Dark=#FFFFFF}"/>
          </Grid>

          <!-- Horas Normais -->
          <Grid RowDefinitions="Auto,Auto" RowSpacing="6">
            <Label Text="âœ“ Horas Normais"
                   FontSize="14"
                   FontAttributes="Bold"
                   TextColor="{AppThemeBinding Light=#34C759, Dark=#30D158}"/>
            <Border x:Name="HorasNormaisBorder"
                    Grid.Row="1"
                    BackgroundColor="{AppThemeBinding Light=#F2F2F7, Dark=#2C2C2E}"
                    StrokeThickness="2"
                    Stroke="Transparent"
                    StrokeShape="RoundRectangle 8">
              <Entry x:Name="HorasNormaisEntry"
                     Placeholder="Ex: 8 ou 8.5"
                     Keyboard="Default"
                     BackgroundColor="Transparent"
                     TextColor="{AppThemeBinding Light=#000000, Dark=#FFFFFF}"
                     PlaceholderColor="{AppThemeBinding Light=#8E8E93, Dark=#8E8E93}"
                     TextChanged="OnHorasChanged"/>
            </Border>
          </Grid>

          <!-- Horas Extras -->
          <Grid RowDefinitions="Auto,Auto" RowSpacing="6">
            <Label Text="âš¡ Horas Extras"
                   FontSize="14"
                   FontAttributes="Bold"
                   TextColor="{AppThemeBinding Light=#FF9500, Dark=#FF9F0A}"/>
            <Border x:Name="HorasExtrasBorder"
                    Grid.Row="1"
                    BackgroundColor="{AppThemeBinding Light=#F2F2F7, Dark=#2C2C2E}"
                    StrokeThickness="2"
                    Stroke="Transparent"
                    StrokeShape="RoundRectangle 8">
              <Entry x:Name="HorasExtrasEntry"
                     Placeholder="Ex: 2 ou 2.5"
                     Keyboard="Default"
                     BackgroundColor="Transparent"
                     TextColor="{AppThemeBinding Light=#000000, Dark=#FFFFFF}"
                     PlaceholderColor="{AppThemeBinding Light=#8E8E93, Dark=#8E8E93}"
                     TextChanged="OnHorasChanged"/>
            </Border>
          </Grid>

          <!-- Total Calculado -->
          <Grid ColumnDefinitions="Auto,*" ColumnSpacing="8">
            <Label Text="ðŸ“Š Total:"
                   FontSize="14"
                   FontAttributes="Bold"
                   TextColor="{AppThemeBinding Light=#000000, Dark=#FFFFFF}"
                   VerticalOptions="Center"/>
            <Label x:Name="TotalHorasLabel"
                   Grid.Column="1"
                   Text="0,00h"
                   FontSize="18"
                   FontAttributes="Bold"
                   TextColor="{AppThemeBinding Light=#007AFF, Dark=#0A84FF}"
                   VerticalOptions="Center"/>
          </Grid>

          <!-- ObservaÃ§Ãµes -->
          <Grid RowDefinitions="Auto,Auto" RowSpacing="6">
            <Label Text="ðŸ“ ObservaÃ§Ãµes"
                   FontSize="14"
                   FontAttributes="Bold"
                   TextColor="{AppThemeBinding Light=#000000, Dark=#FFFFFF}"/>
            <Editor x:Name="ObservacoesEditor"
                    Grid.Row="1"
                    Placeholder="ObservaÃ§Ãµes adicionais"
                    HeightRequest="80"
                    BackgroundColor="{AppThemeBinding Light=#F2F2F7, Dark=#2C2C2E}"
                    TextColor="{AppThemeBinding Light=#000000, Dark=#FFFFFF}"
                    PlaceholderColor="{AppThemeBinding Light=#8E8E93, Dark=#8E8E93}"/>
          </Grid>

          <!-- Erro -->
          <Label x:Name="ErrorLabel"
                 TextColor="{AppThemeBinding Light=#FF3B30, Dark=#FF453A}"
                 FontSize="13"
                 IsVisible="False"
                 HorizontalOptions="Center"/>
        </VerticalStackLayout>
      </ScrollView>

      <!-- BotÃµes -->
      <Grid Grid.Row="2" ColumnDefinitions="Auto,*,Auto,Auto" ColumnSpacing="16">
        <!-- Eliminar (sÃ³ aparece ao editar) -->
        <Button x:Name="EliminarButton"
                WidthRequest="56"
                HeightRequest="56"
                Padding="0"
                BackgroundColor="#F44336"
                CornerRadius="28"
                IsVisible="False"
                Clicked="OnEliminarClicked">
          <Button.Shadow>
            <Shadow Brush="Black" Opacity="0.25" Radius="8" Offset="0,2"/>
          </Button.Shadow>
          <Button.ImageSource>
            <FontImageSource Glyph="&#xF1F8;" FontFamily="FA7Solid" Size="22" Color="White"/>
          </Button.ImageSource>
        </Button>

        <BoxView Grid.Column="1"/>

        <!-- Cancelar -->
        <Button x:Name="CancelarButton"
                Grid.Column="2"
                WidthRequest="56"
                HeightRequest="56"
                Padding="0"
                BackgroundColor="#FF3B30"
                CornerRadius="28"
                Clicked="OnCancelarClicked">
          <Button.Shadow>
            <Shadow Brush="Black" Opacity="0.25" Radius="8" Offset="0,2"/>
          </Button.Shadow>
          <Button.ImageSource>
            <FontImageSource Glyph="&#xF00D;" FontFamily="FA7Solid" Size="22" Color="White"/>
          </Button.ImageSource>
        </Button>

        <!-- Guardar -->
        <Button x:Name="GuardarButton"
                Grid.Column="3"
                WidthRequest="56"
                HeightRequest="56"
                Padding="0"
                BackgroundColor="#34C759"
                CornerRadius="28"
                Clicked="OnGuardarClicked">
          <Button.Shadow>
            <Shadow Brush="Black" Opacity="0.25" Radius="8" Offset="0,2"/>
          </Button.Shadow>
          <Button.ImageSource>
            <FontImageSource Glyph="&#xF00C;" FontFamily="FA7Solid" Size="22" Color="White"/>
          </Button.ImageSource>
        </Button>
      </Grid>

      <!-- Loading -->
      <Grid Grid.RowSpan="3"
            x:Name="BusyOverlay"
            IsVisible="False"
            BackgroundColor="#99000000">
        <ActivityIndicator IsRunning="True"
                           Color="{AppThemeBinding Light=#007AFF, Dark=#0A84FF}"
                           WidthRequest="48"
                           HeightRequest="48"/>
      </Grid>
    </Grid>
  </Border>
</toolkit:Popup>
